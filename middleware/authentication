;
const {STATUS_MESSAGES, STATUS_CODES} = require('../utils/consts');

module.exports = (Users) => {
  return function (req, res, next) {
    let token = req.header('Authorization');

    Users.findByToken(token).then((user) => {
      if (!user) {
        return res.status(STATUS_CODES.UNAUTHORIZED)
          .send(STATUS_MESSAGES.UNAUTHORIZED);
      }

      req.user = user;
      req.token = token;

      next();
    }).catch((e) => {
      console.log(e)
        res.status(STATUS_CODES.UNAUTHORIZED)
          .send(STATUS_MESSAGES.UNAUTHORIZED)
      }
    );
  }
};
